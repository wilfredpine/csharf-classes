<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OOP Framework Documentation</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; line-height: 1.6; }
        h1, h2, h3 { color: #2c3e50; }
        pre { background: #f4f4f4; padding: 10px; border-radius: 5px; overflow-x: auto; }
        code { color: #c0392b; }
        .section { margin-bottom: 40px; }
        .example { background: #ecf0f1; padding: 10px; border-radius: 5px; }
    </style>
</<body>

<h1>OOP Framework Documentation</h1>
<p>A lightweight C# framework for building modular, database-driven applications.</p>

<hr>

<div class="section">
<h2>Step 1: Initial Project Setup</h2>
<ol>
    <li>In <strong>Solution Explorer</strong>, right-click on your project name and:
        <ul>
            <li>Add a new folder named <code>Classes</code>.</li>
        </ul>
    </li>
    <li>Right-click on <code>Classes</code> folder:
        <ul>
            <li>Add existing items:
                <ul>
                    <li><code>AppDb.cs</code></li>
                    <li><code>IDatabase.cs</code></li>
                    <li><code>SqlDatabase.cs</code></li>
                </ul>
            </li>
        </ul>
    </li>
    <li>Open <code>App.config</code> and add inside <code>&lt;configuration&gt;</code>:
        <pre><code>&lt;connectionStrings&gt;
&lt;add name="AppDB" connectionString="Data Source=(LocalDB)\MSSQLLocalDB;AttachDbFilename=C:\Path\To\YourDB.mdf;Integrated Security=True;Connect Timeout=30" /&gt;
&lt;/connectionStrings&gt;</code></pre>
        <p>Modify the connection string to match your database.</p>
    </li>
    <li>Open <code>Program.cs</code> and add inside <code>Main()</code>:
        <pre><code>// Optional: set DataDirectory if using .mdf relative to EXE
// var dataDir = Path.Combine(AppDomain.CurrentDomain.BaseDirectory, "Data");
// AppDomain.CurrentDomain.SetData("DataDirectory", dataDir);
Application.ApplicationExit += (_, __) =&gt; red_framework.AppDb.Dispose();</code></pre>
    </li>
    <li>Right-click on <strong>References</strong> → Add Reference → Assemblies → Check <code>System.Configuration</code>.</li>
</ol>
</div>

<hr>

<div class="section">
<h2>Step 2: Sample CRUD Form</h2>
<p>Below is a sample implementation using <code>red_framework</code>:</p>
<pre><code>using red_framework;
using System;
using System.Data;
using System.Windows.Forms;

namespace OOP_Framework
{
    public partial class Form1 : Form
    {
        private int _selectedId = 0;

        public Form1() { InitializeComponent(); }

        void clearInputs() {
            txtIDNumber.Clear();
            txtFirstName.Clear();
            txtMiddleName.Clear();
            txtLastName.Clear();
            txtContactNumber.Clear();
            dtpBirthday.Value = DateTime.Now;
            _selectedId = 0;
        }

        private void btnSave_Click(object sender, EventArgs e) {
            var db = AppDb.Instance;
            if (_selectedId == 0) {
                var ok = db.Save("Students", new {
                    Id_Number = txtIDNumber.Text,
                    First_Name = txtFirstName.Text,
                    Middle_name = txtMiddleName.Text,
                    Last_Name = txtLastName.Text,
                    Contact_Number = txtContactNumber.Text,
                    Birthday = dtpBirthday.Value
                });
                MessageBox.Show(ok ? "Successfully Saved." : "Insert failed.");
            } else {
                var updateok = db.Update("Students", new { Id = _selectedId, First_Name = txtFirstName.Text });
                MessageBox.Show(updateok ? "Successfully Updated." : "Update failed.");
            }
            loadStudentRecords();
            clearInputs();
        }

        void loadStudentRecords() {
            var db = AppDb.Instance;
            db.Table(
                "SELECT Id, Id_Number, First_Name, Middle_name, Last_Name, Contact_Number, Birthday FROM Students ORDER BY Id DESC",
                dgvStudent,
                header: new[] { "Id", "ID Number", "First Name", "Middle Name", "Last Name", "Contact", "Birthday" }
            );
            dgvStudent.Columns["Id"].Visible = false;
        }

        private void Form1_Load(object sender, EventArgs e) { loadStudentRecords(); }

        private void dgvStudent_CellClick(object sender, DataGridViewCellEventArgs e) {
            if (e.RowIndex &lt; 0) return;
            var drv = dgvStudent.Rows[e.RowIndex].DataBoundItem as DataRowView;
            if (drv == null) return;
            _selectedId = (int)drv[0];
            txtIDNumber.Text = drv[1]?.ToString() ?? "";
            txtFirstName.Text = drv[2]?.ToString() ?? "";
            txtMiddleName.Text = drv[3]?.ToString() ?? "";
            txtLastName.Text = drv[4]?.ToString() ?? "";
            txtContactNumber.Text = drv[5]?.ToString() ?? "";
            dtpBirthday.Value = Convert.ToDateTime(drv[6]);
        }

        private void btnDelete_Click(object sender, EventArgs e) {
            if(_selectedId == 0) { MessageBox.Show("No record selected."); return; }

            // Confirmation dialog
            var confirmResult = MessageBox.Show(
                "Are you sure you want to delete this record?",
                "Confirm Delete",
                MessageBoxButtons.YesNo,
                MessageBoxIcon.Question
            );

            if (confirmResult == DialogResult.Yes)
            {
                var ok = AppDb.Instance.Delete("Students", new { Id = _selectedId });

                MessageBox.Show(ok ? "Successfully Deleted." : "Delete failed.");

                loadStudentRecords();
                clearInputs();
            }
        }

        private void btnSearch_Click(object sender, EventArgs e) {
            var db = AppDb.Instance;
            var results = db.Search("Students", new[] { "First_Name", "Last_Name", "Id_Number" }, txtSearchInput.Text);
            db.Table(results, dgvStudent, header: new[] { "Id", "ID Number", "First Name", "Middle Name", "Last Name", "Contact", "Birthday" });
            dgvStudent.Columns["Id"].Visible = false;
        }

        private void btnClear_Click(object sender, EventArgs e) { clearInputs(); }
    }
}</code></pre>
</div>

<hr>

<div class="section">
<h2>Step 3: SqlDatabase Public Methods Documentation</h2>

<p>Before the methods usage</p>
<pre><code>var db = AppDb.Instance;</code></pre>

<h3>1. CUD</h3>
<pre><code>int CUD(string query, object parameters = null)</code></pre>
<p><strong>Purpose:</strong> Executes INSERT, UPDATE, DELETE.</p>
<p><strong>Returns:</strong> Number of affected rows.</p>
<p><strong>Examples:</strong></p>
<pre><code>// Before the methods usage
var db = AppDb.Instance;

// INSERT
db.CUD("INSERT INTO Students (First_Name, Last_Name) VALUES (@First, @Last)",
       new { First = "John", Last = "Doe" });

// UPDATE
db.CUD("UPDATE Students SET First_Name=@First WHERE Id=@Id",
       new { First = "Jane", Id = 1 });

// DELETE
db.CUD("DELETE FROM Students WHERE Id=@Id", new { Id = 1 });</code></pre>

<h3>2. Scalar</h3>
<pre><code>object Scalar(string query, object parameters = null)</code></pre>
<p>Returns first column of first row.</p>
<pre><code>var count = db.Scalar("SELECT COUNT(*) FROM Students");</code></pre>

<h3>3. TableData</h3>
<pre><code>DataTable TableData(string query, object parameters = null)</code></pre>
<p>Returns query results as DataTable.</p>
<pre><code>var dt = db.TableData("SELECT * FROM Students");
dgvStudent.DataSource = dt;</code></pre>

<h3>4. Save</h3>
<pre><code>bool Save(string table, object data)</code></pre>
<p>Inserts a row using object's properties.</p>
<p><strong>Returns:</strong> Number of affected rows.</p>
<pre><code>db.Save("Students", new { First_Name = "Jane", Last_Name = "Doe" });</code></pre>

<h3>5. Update</h3>
<pre><code>bool Update(string table, object data, string keyColumn = "Id")</code></pre>
<p>Updates a row by key column.</p>
<p><strong>Returns:</strong> Number of affected rows.</p>
<pre><code>db.Update("Students", new { Id = 1, First_Name = "UpdatedName" });
//or
db.Update("Students", new { Id = 1, First_Name = "UpdatedName" }, "Id");</code></pre>

<h3>6. Delete</h3>
<pre><code>bool Delete(string table, object data, string keyColumn = "Id")</code></pre>
<p>Deletes a row by key column.</p>
<p><strong>Returns:</strong> Number of affected rows.</p>
<pre><code>db.Delete("Students", new { Id = 1 });
//or
db.Delete("Students", new { Id = 1 }, "Id");</code></pre>

<h3>7. Search</h3>
<pre><code>DataTable Search(string table, string[] columns, string keyword)</code></pre>
<p>Performs LIKE search.</p>
<p>Return a DataTable.</p>
<pre><code>var results = db.Search("Students", new[] { "First_Name", "Last_Name" }, "John");
dgvStudent.DataSource = results;</code></pre>
<p>or</p>
<pre><code>var results = db.Search("Students", new[] { "First_Name", "Last_Name" }, "John");
db.Table(
        results, 
        dgvStudent, 
        header: new[] { "Id", "ID Number", "First Name", "Middle Name", "Last Name", "Contact", "Birthday" }
    );</code></pre>


<h3>8. Count</h3><pre><code>int Count(string table, string condition = "")
bool Exists(string table, string condition)</code></pre>
<p><strong>Purpose:</strong> Count rows or check if any row matches a condition.</p>
<p><strong>Returns:</strong> <code>Count</code> returns an integer; <code>Exists</code> returns true/false.</p>
<pre><code>// Count all students
int total = db.Count("Students");

// Count with condition
int active = db.Count("Students", "IsDeleted=0");

// Check existence
bool hasJohn = db.Exists("Students", "First_Name='John'");
</code></pre>

<h3>9. Max / Min</h3>
<pre><code>object Max(string table, string column)
object Min(string table, string column)</code></pre>
<p><strong>Purpose:</strong> Get maximum or minimum value of a column.</p>
<pre><code>var maxId = db.Max("Students", "Id");
var minBirthday = db.Min("Students", "Birthday");
</code></pre>

<h3>10. Sum / Average</h3>
<pre><code>decimal Sum(string table, string column, string condition = "")
decimal Average(string table, string column, string condition = "")</code></pre>
<p><strong>Purpose:</strong> Aggregate numeric columns.</p>
<pre><code>decimal totalFees = db.Sum("Payments", "Amount");
decimal avgAge = db.Average("Students", "DATEDIFF(year, Birthday, GETDATE())");
</code></pre>

<h3>11. Paginate / PaginateWithCount</h3>
<pre><code>DataTable Paginate(string table, int pageNumber, int pageSize, string orderBy = "Id ASC")
(DataTable Rows, int TotalCount) PaginateWithCount(string table, int pageNumber, int pageSize)</code></pre>
<p><strong>Purpose:</strong> Fetch paginated results.</p>
<pre><code>// Simple pagination
var page1 = db.Paginate("Students", 1, 10);

// Pagination with total count
var result = db.PaginateWithCount("Students", 1, 10);
DataTable rows = result.Rows;
int total = result.TotalCount;
</code></pre>

<h3>12. ExecuteTransaction</h3>
<pre><code>bool ExecuteTransaction(params (string query, object parameters)[] commands)
bool ExecuteTransaction(Func<SqlTransaction, bool> work)</code></pre>
<p><strong>Purpose:</strong> Execute multiple commands atomically.</p>
<pre><code>// Batch transaction
db.ExecuteTransaction(
    ("INSERT INTO Students (First_Name) VALUES (@Name)", new { Name = "Alice" }),
    ("INSERT INTO Students (First_Name) VALUES (@Name)", new { Name = "Bob" })
);

// Custom transaction logic
db.ExecuteTransaction(tran => {
    db.CUD("UPDATE Students SET First_Name='X' WHERE Id=1");
    return true;
});
</code></pre>

<h3>13. QuerySingle&lt;T&gt; / QueryList&lt;T&gt;</h3>
<pre><code>T QuerySingle<T>(string query, object parameters = null)
List<T> QueryList<T>(string query, object parameters = null)</code></pre>
<p><strong>Purpose:</strong> Map query results to POCO objects.</p>
<pre><code>// Define POCO
public class Student {
    public int Id { get; set; }
    public string First_Name { get; set; }
    public string Last_Name { get; set; }
}

// Single record
var student = db.QuerySingle<Student>("SELECT * FROM Students WHERE Id=@Id", new { Id = 1 });

// List of records
var students = db.QueryList<Student>("SELECT * FROM Students");
</code></pre>

<h3>14. BulkInsert</h3>
<pre><code>bool BulkInsert(string table, DataTable data)</code></pre>
<p><strong>Purpose:</strong> Insert multiple rows efficiently.</p>
<pre><code>// Prepare DataTable and bulk insert
db.BulkInsert("Students", myDataTable);
</code></pre>

<h3>15. Backup</h3>
<pre><code>bool Backup(string filePath)</code></pre>
<p><strong>Purpose:</strong> Backup database to a file.</p>
<pre><code>db.Backup(@"C:\Backup\MyDatabase.bak");
</code></pre>

<h3>16. Ping</h3>
<pre><code>bool Ping()</code></pre>
<p><strong>Purpose:</strong> Check database connectivity.</p>
<pre><code>if (db.Ping()) Console.WriteLine("Database is online");
</code></pre>

<h3>17. Stored Procedures</h3>
<pre><code>int ExecStoredProcedure(string procName, object parameters = null)
DataTable QueryStoredProcedure(string procName, object parameters = null)</code></pre>
<p><strong>Purpose:</strong> Execute stored procedures.</p>
<pre><code>// Execute procedure without result
db.ExecStoredProcedure("sp_UpdateStudent", new { Id = 1, Name = "Updated" });

// Execute procedure with result
var dt = db.QueryStoredProcedure("sp_GetStudents");
</code></pre>

<h3>18. Upsert / SoftDelete / Restore / Touch</h3>
<pre><code>bool Upsert(string table, string keyColumn, object data)
bool SoftDelete(string table, object id)
bool Restore(string table, object id)
bool Touch(string table, object id)</code></pre>
<p><strong>Purpose:</strong> Advanced row operations.</p>
<pre><code>// Upsert
db.Upsert("Students", "Id", new { Id = 1, First_Name = "John" });

// Soft delete
db.SoftDelete("Students", 1);

// Restore
db.Restore("Students", 1);

// Touch (update timestamp)
db.Touch("Students", 1);
</code></pre>

<h3>19. Schema Methods</h3>
<pre><code>DataTable GetSchemaTables()
DataTable GetSchemaColumns(string table)
bool ColumnExists(string table, string column)</code></pre>
<p><strong>Purpose:</strong> Inspect database schema.</p>
<pre><code>var tables = db.GetSchemaTables();
var columns = db.GetSchemaColumns("Students");
bool hasColumn = db.ColumnExists("Students", "First_Name");
</code></pre>

<h3>20. WinForms Helpers</h3>
<pre><code>void Table(DataTable dt, DataGridView dgv, string[] header = null)
void Table(string query, DataGridView dgv, string[] header = null)
void Table(string query, object parameters, DataGridView dgv, string[] header = null)
void Table(string query, ListView lv, string[] headers = null)
void list(string query, ComboBox comboBox)</code></pre>
<p><strong>Purpose:</strong> Bind query results to UI controls.</p>
<pre><code>// Bind DataGridView
db.Table("SELECT * FROM Students", dgvStudent);

// Bind ComboBox
db.list("SELECT First_Name FROM Students", comboBoxNames);
</code></pre>

</div>

<hr>

<div class="section">
<h2>Step 4: Best Practices</h2>
<ul>
    <li>Always use parameterized queries to prevent SQL injection.</li>
    <li>Dispose database connections on application exit.</li>
    <li>Use <code>AppDb.Instance</code> for centralized DB access.</li>
</ul>
</div>

<footer>
<p>&copy; 2025 OOP Framework. All rights reserved.</p>
</footer>

</body>
</html>